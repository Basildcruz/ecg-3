<html>
    <head>
        <link rel="stylesheet" href="index.css" />
        <script type="text/javascript" src="../lib/require.js"></script>
        <script type="text/javascript">
            requirejs.config({
                baseUrl : './'
            });

            require(['Electrocardiogram'], function(Electrocardiogram) {
                var ecg = new Electrocardiogram(document.body);

                require(['text!../resource/ecg.json'], function(json) {
                    var n = Math.round(ecg.getWidth() / Electrocardiogram.CELL_SIZE);

                    try {
                        var data = (function(s) {
                            var arr = JSON.parse(s);

                            for (var i = 0; i < n - 1; i++) {
                                arr.unshift(null);
                            }

                            return arr;
                        })(json);

                        var timer = window.setInterval(function() {
                            if (data.length) {
                                ecg.drawCurve(data.slice(0, n));
                                data.shift();
                            } else {
                                window.clearInterval(timer);
                            }
                        }, Electrocardiogram.FREQUENCY);
                    } catch (e) {
                        console.error(e.message);
                    }
                });
            });
        </script>
    </head>
    <body>
    </body>
</html>
